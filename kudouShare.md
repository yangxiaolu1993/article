
##### 标题
 * TS 与 Vue 的完美结合
 * 为酷兜锦上添花 - TS 在 vue 中的实战
 * 

对于开发者来说，bug与新需求都不是最大的难题，在其他人员的代码上进行二次开发可能是最头疼的一件事情。主要是因为不能按照自己的思路、逻辑进行开发，需要先了解他人的思路、逻辑，并在此基础上进行二次开发。对于酷兜来说，2020年是关键的一年，但是酷兜的代码经过多次的版本迭代、功能优化，代码已经变的冗余严重、逻辑不清楚，再加上底层架构版本过低，兼容性不加，用户体验不佳。为了更好的满足2020年酷兜快速迭代更新的需求以及性能要求，提高用户体验。开发人员与产品一致决定进行前端的重构。  

* 项目目录结构
* 使用NutUI组件库
* 技术栈中增加 Typescript 
* 布局使用100%
* 浏览器history

### 目录结构
一个好的目录结构，能是多人开发有序的进行，也方便管理。

### NutUI组件库
在JQuery横行霸道的时候，UI视觉库称为框架，随着技术的不断更新、发展，使用Vue、React单页面开发越来越流行，逐渐替代了JQuery开发方式。单页面开发是以组件为主，所以UI框架也就改名为UI组件库。  
对于前端开发引入UI组件库，不仅能够减少自己的代码量，提高开发效率，而且组件库经过多次的用户反馈，版本迭代，功能已经很完善，能有效的减少bug与兼容性的出现。但是现在开源的UI组件库琳琅满目，选择一款合适的UI组件库尤为重要。  
酷兜以vue为技术栈的移动端项目。选择一款合适的ui组件成了重构的第一件事。现在流行的开源的移动端UI组件库主要有mint-ui、vant、nutui等，到底哪个组件库更合适酷兜。先来对比一下这几个组件库更新时间。

|        | 团队 |  GitHub最后更新时间 | 简介 | 
|  ----  | ----  | ---- | ---- | 
| mint-ui  | 饿了么团队开发、维护 | 2018年1月16号 | |
| vant | 有赞团队开发，维护 | 2020年4月5号 |  Vant是一个轻量、可靠的移动端 Vue 组件库  |
| nutui | 京东团队开发、维护 | 2020年4月3号 |  一套京东风格的轻量级移动端Vue组件库  |  

任何一个开发人员都不敢肯定自己写的组件可以适用于任何的业务场景，较高的更新时间可以说明该组件在日常维护中，不用担心在开发过程中，组件bug与解答无人理会，导致失去使用组件库的价值。从更新时间和维护团队来说，vant和nutui在这4个组件库中更胜一筹。

|    功能    | mint-ui |  vant |  nutui |
|  ----  | ----  | ---- |  ---- |
| 上拉加载、下拉刷新 | √ |  × | √|
| Dialog对话框  |  √ |  √ | √| 
| Toast 吐司  |  √ |  √  | √|
| 回到顶部  |  × |  × | √|
| 左滑删除  |  × |  √  | √| 
| 上传  |  × |  √ | √|
| Popup 弹出层  |  √ |  √  | √|
| Stepper 步进器  |  × |  √  | √| 
| 图片懒加载  |  √ |  ×  | √| 
| 时间轴  |  × |  √ | √|
| 搜索栏  |  √ |  √ | √|
| 商品价格  |  × |  × |  √|
| 徽标  |  √ |  × |  √|

选择一个适合的组件库还有更重要的一点就是组件库的使用率，从酷兜需要的功能组件的使用率来说，nutui无疑是最佳的选择。

当然选择nutui组件库并不单单是因为更新频率与使用率，还有最重要的一点就是nutui组件库兼容了vue+typescript的开发方式。现在typescript开发逐渐成为主流，而且vue3.0也是使用typescript开发，这就更加肯定了，酷兜使用nutui组件库进行重构。

### Typescript
从2018年vue开始重写到vue3.0源码的公布，大家一直期待vue3.0的正式发布，在这两年的时间里，我们听到最多的信息可能就是vue3.0是使用了typescript进行重构。为了更好的兼容之后的vue版本，也为了增加代码的可读性与可维护性，在酷兜V2.2版本我们加入的了typescript。  
刚刚开始接触typescript时，我的第一反应就是，为什么要在项目中加typescript，有啥用，除了增加一个成本，好像没啥用。而且typescript和ES6的语法有很高的相似度，感觉完全没有必要使用typescript，其实不然，ES6 只是 JavaScript 的语言规范，而typescript 是 Microsoft 开发和维护的一种面向对象的编程语言，与JavaScript是两种脚本语言。只不过typescript中可以使用JavaScript中所有的代码和编码概念。但是不管是用ES6语法进行开发，还是使用Typescript进行开发，最终都是需要转换成浏览器识别的JavaScript语言。

* 类型检查  
    JavaScript是弱类型语言，而弱类型语言特点之一就是没有严格的类型定义，定义变量时都是用统一的var或const关键字，这样虽然不会影响代码的运行，但是运行时隐含的类型转换，也会损耗性能。而typescript则增加了类型和接口等概念来定义变量的类型，避免浏览器运行时类型转换。
* 编译过程
    JavaScript从另一个角度分类，也可以成为解释型语言，与编译型语言相对。无需编译，只要嵌入HTML代码中，就能由浏览器加载解释执行。而typescript，在嵌入HTML代码之前，通过编译进行类型注解对静态类型的检查，保证变量类型一致，并转换成JavaScript代码，保证浏览器加载解释执行。
    
说了这么多Typescript开发的好处，那在酷兜重构中typescript对我开发有哪些帮助呢！

#### 1、减少了注释
在实际开发中，阅读、使用其他开发者代码的情况是避免不了的，想要快速掌握代码逻辑、使用规则，清晰的代码注释就显得尤为重要了。  

![查看类型](https://storage.360buyimg.com/imgtools/3ebaa053d8-bf159260-8120-11ea-bda4-45e44354cb16.gif)  

结合 VScode 编译工具，我们可以很清楚的了解：baseParams 对象的 key 值有哪些，每个 key 的类型是什么，初始值是什么，对于程序猿来说是不是比任何注释都好用。也节省了在多人开发的过程中，大家沟通、查找对象定义的时间。

注：在 VS code 的编辑器中，当鼠标移动到某些文本之后，稍作片刻就会出现一个悬停提示窗口，这个窗口里会显示跟鼠标下文本相关的信息。如果想要查看对象就具体信息，需要按下 Cmd 键（Windows 上是 Ctrl）。

#### 2、减少bug
当定义好一个函数时，虽然在注释上明确标注了参数的类型，但是多人开发过程中，很多人都不会去注意参数的类型。在 JavaScript 中不同的类型有不同的方法，比如：一串数字的长度，string 类型可以使用length() 方法，但 number 类型就没有 length() 方法。若定义的方法中对参数使用的 length() 方法，传入的是 number 类型，bug就诞生了。

不知道大家有没有注意过 toFixed() 这个方法，将 number 类型的数字按照银行家舍入规则保留小数位数，重点来了，得到的值是 string 类型。一不注意这样的类型转换，就会出现bug，但在 TS 中因为定义了字段的类型，若字段赋值了其他的类型，就会出现错误提示。

```
const a = 123.4864356
let b = 123
b = b + a.toFixed(1)
console.log(b) //123123.5
```
正如上面的列子，我们期待得到的是246.5，最终得到123123.5，原因就是 a.toFixed(1) 得到的是字符串类型。如果使用 TS 的话，我们就可以提前搞定这个bug。

![](https://img14.360buyimg.com/imagetools/jfs/t1/102561/29/19316/55950/5e9c431cEe5e9e0b4/6e2c38f961258ae6.png)

我们会发现，当鼠标移动到 b 变量的时候，会提示类型赋值错误。不光在编写时有错误提示，在 TS 编译时，也会报错提示，虽然 TS 的编译错误并不影响项目的运行，但不保证不出现bug哟，还是仔细看看滴！

![](https://img13.360buyimg.com/imagetools/jfs/t1/99310/26/19169/39502/5e9c4483E23e63f53/21529d59e297d369.png)

### typescript 在 vue 中的应用

Typescript 与 vue 的结合，我们使用官方维护的 vue-class-component 装饰器，了解了 typescript 中的装饰器，能让我们更加了解 typescript 在 vue 中的应用。


#### 装饰器
装饰器是一种特殊类型的声明，它能够被附加到类声明，方法， 访问符，属性或参数上。 装饰器使用 @expression这种形式，expression求值后必须为一个函数，它会在运行时被调用，被装饰的声明信息做为参数传入。

#### typescript 装饰器在 vue 中的应用


